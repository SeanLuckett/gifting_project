(function($){

  var dfd = $.Deferred();
  window.fb_friends = dfd.promise();

  window.fbAsyncInit = function() {
     FB.init({
      appId   : <%= ENV['FACEBOOK_KEY'] %>,
      channelUrl: <%= "'//localhost:3000/channel.html'," unless Rails.env.production? %>
      status  : true,
      cookie  : true,
      xfbml   : true
    });

    FB.getLoginStatus(function(response){
      FB.api("/me/friends?fields=name,email,birthday", function(friends){
        dfd.resolve( friends.data );
      });
    });
  };

})(jQuery);
